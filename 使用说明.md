# HomeAssistant Edge Data Generator

智能家居控制数据生成器，用于生成高难度的智能家居控制训练数据，输出格式为ShareGPT格式。

## 项目结构

```
HomeAssistant-Edge-Data/
├── config.py                 # 配置文件（设备、服务、颜色等）
├── main.py                   # 主程序入口
├── generators/               # 数据生成器模块
│   ├── __init__.py
│   ├── base_generator.py    # 基础生成器（抽象类）
│   ├── sequential_generator.py  # 连续操作生成器
│   └── batch_generator.py   # 统一操作生成器
├── utils/                    # 工具模块
│   ├── __init__.py
│   ├── device_manager.py    # 设备管理器
│   └── service_manager.py   # 服务管理器
└── readme.md                 # 项目说明文档
```

## 功能特性

### 1. 连续操作数据生成
生成多个连续的不同设备操作指令，例如：
- 输入：`开灯1，关灯2，开窗帘1`
- 输出：包含所有操作的结构化数据

**特点：**
- 支持2-5个连续操作
- 自动生成人性化回复（2个操作时："已经xx和xx"，多个操作时："All completed!"）
- 支持随机设备和操作选择

### 2. 统一操作数据生成
生成对同类设备的批量操作，例如：
- 输入：`把所有的灯变成红色`
- 输出：对所有灯设备的统一操作

**特点：**
- 支持所有设备类型的批量操作
- 只操作系统指令中配置的设备
- 支持灯光的颜色和亮度设置

### 3. 模块化设计
- **可扩展**：通过继承BaseGenerator轻松添加新的生成器
- **可编辑**：配置文件集中管理，方便修改设备和服务
- **模块化**：清晰的模块划分，便于维护

## 安装与使用

### 安装依赖
```bash
pip install -r requirements.txt
```

### 基本使用

#### 1. 生成混合数据（默认）
```bash
python main.py
```
默认生成20条混合数据（连续操作+统一操作各10条）

#### 2. 生成连续操作数据
```bash
python main.py --type sequential --count 50
```

#### 3. 生成统一操作数据
```bash
python main.py --type batch --count 30
```

#### 4. 指定输出文件
```bash
python main.py --output my_data.json
```

#### 5. 预览生成的数据
```bash
python main.py --preview
```

#### 6. 高级参数

指定连续操作的操作数量：
```bash
python main.py --type sequential --operations 3
```

指定统一操作的设备类型：
```bash
python main.py --type batch --device-type light
```

### 命令行参数说明

| 参数 | 简写 | 说明 | 默认值 |
|------|------|------|--------|
| `--type` | `-t` | 数据类型：sequential/batch/mixed | mixed |
| `--count` | `-c` | 生成数量 | 20 |
| `--output` | `-o` | 输出文件名 | generated_data.json |
| `--preview` | `-p` | 预览生成的数据 | False |
| `--operations` | | 连续操作的操作数量 | 随机2-5 |
| `--device-type` | | 统一操作的设备类型 | 随机 |

## 配置说明

### 添加新设备
在 `config.py` 中的 `DEVICES` 字典中添加：
```python
DEVICES = {
    "light": [
        {"id": "light.new_light", "name": "New Light"},
        # ... 更多设备
    ]
}
```

### 添加新服务
在 `config.py` 中的 `SERVICES` 字典中添加：
```python
SERVICES = {
    "light": [
        "light.new_service()",
        # ... 更多服务
    ]
}
```

### 添加新颜色
在 `config.py` 中的 `COLORS` 字典中添加：
```python
COLORS = {
    "新颜色": [R, G, B],
}
```

## 扩展开发

### 添加新的生成器

1. 在 `generators/` 目录下创建新文件
2. 继承 `BaseGenerator` 类
3. 实现 `generate()` 方法

示例：
```python
from generators.base_generator import BaseGenerator

class CustomGenerator(BaseGenerator):
    def generate(self, count: int = 1) -> List[Dict]:
        # 实现你的生成逻辑
        pass
```

### 自定义服务映射

在 `utils/service_manager.py` 中修改 `SERVICE_ACTION_MAP` 字典，添加中文动作描述：

```python
SERVICE_ACTION_MAP = {
    "light.turn_on": ["打开", "开启", "点亮", "开"],
    # ... 添加更多映射
}
```

## 输出格式

生成的数据采用ShareGPT格式：

```json
{
  "messages": [
    {
      "role": "system",
      "content": "系统提示..."
    },
    {
      "role": "user",
      "content": "用户输入..."
    },
    {
      "role": "assistant",
      "content": "助手回复...\n```homeassistant\n服务调用JSON\n```"
    }
  ]
}
```

## 示例输出

### 连续操作示例
```json
{
  "messages": [
    {
      "role": "user",
      "content": "打开客厅灯，关闭卧室窗帘，锁上前门"
    },
    {
      "role": "assistant",
      "content": "All completed!\n```homeassistant\n{\"service\": \"light.turn_on\", \"target_device\": \"light.living_room\"}\n{\"service\": \"cover.close_cover\", \"target_device\": \"cover.bedroom\"}\n{\"service\": \"lock.lock\", \"target_device\": \"lock.front_door\"}\n```"
    }
  ]
}
```

### 统一操作示例
```json
{
  "messages": [
    {
      "role": "user",
      "content": "把所有的灯变成红色"
    },
    {
      "role": "assistant",
      "content": "All the lights have turned red\n```homeassistant\n{\"service\": \"light.turn_on\", \"target_device\": \"light.living_room\", \"rgb_color\": \"(255, 0, 0)\"}\n{\"service\": \"light.turn_on\", \"target_device\": \"light.bedroom\", \"rgb_color\": \"(255, 0, 0)\"}\n```"
    }
  ]
}
```

## 注意事项

1. 所有操作的设备必须在系统指令中配置
2. 不会输出未配置的设备
3. 支持的设备类型：light, cover, lock, fan, vacuum, media_player, timer
4. 颜色和亮度参数只适用于灯光设备

## 后续扩展计划

- [ ] 添加条件操作（如果...则...）
- [ ] 添加时间相关操作（定时、延迟）
- [ ] 添加场景模式（离家模式、睡眠模式等）
- [ ] 添加设备状态查询
- [ ] 添加更多设备类型支持
- [ ] 添加数据验证功能
- [ ] 添加批量导入设备功能

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！
